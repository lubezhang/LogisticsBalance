<script type="text/javascript" src="./script/jquery/jquery.easyui.min.js"></script>
<script type="text/javascript">
    function loadBalanceData(){
        $('#dg').datagrid({
            url:'/replenishController/queryBalanceList.do',
            columns:[[
                {field:'balanceId',title:'快递单编号',checkbox:true,width:100},
                {field:'addresseeDate',title:'收件日期',width:60,align:"center"},
                {field:'balanceCode',title:'快递单号',width:60,align:"center"},
                {field:'customerId',title:'客户名称',width:160,align:"center"},
                {field:'money',title:'金额',width:40,align:"center"},
                {field:'gatherState',title:'收款状态',width:20,align:"center"},
                {field:'payoffState',title:'结算状态',width:20,align:"center"}
            ]],
            queryParams: {
                balanceCode: $("#balanceCode").val(),
                customerId: $("#customerId").val(),
                payoffState: $('#payoffState').combobox('getValue'),
                addrDateBegin: $('#addresseeDate1').datebox('getValue'),
                addrDateEnd: $('#addresseeDate2').datebox('getValue')
            },
            method:"post",
            onLoadSuccess:function(json){
                //debugger;
                //alert(json);
            },
            onHeaderContextMenu:function(){
               // alert(8)
            }
        });
        getTotalMoney();
    }

    function getTotalMoney(){
        var params = "customerId=" + $("#customerId").val();
        params += "&payoffState=" + $('#payoffState').combobox('getValue');
        params += "&balanceCode=" + $("#balanceCode").val();
        params += "&addrDateBegin=" + $('#addresseeDate1').datebox('getValue');
        params += "&addrDateEnd=" + $('#addresseeDate2').datebox('getValue');
        $("#exportBtn").attr("href","/replenishController/exportLogistics.do?"+params);
        $.post(
            "/replenishController/getTotalMoney.do",
            params,
            function(json){
                if(json){
                    var strComplete = "";
                    if(json.successful){
//                            strComplete = "应收金额："+json.resultValue.totalMoney;
//                            $.messager.alert("处理信息",strComplete,"info",function(){});
                        $("#money1").html(json.resultValue.payMoney);
                        $("#money2").html(json.resultValue.notPayMoney);
                    } else {
                        strComplete = json.message;
                        $.messager.alert("处理信息",strComplete,"error",function(){});
                    }
                }
            },
            "json"
        );
    }

    function downloadBalance(){
        var params = "customerId=" + $("#customerId").val();
        params += "&payoffState=" + $('#payoffState').combobox('getValue');
        params += "&balanceCode=" + $("#balanceCode").val();
        params += "&addrDateBegin=" + $('#addresseeDate1').datebox('getValue');
        params += "&addrDateEnd=" + $('#addresseeDate2').datebox('getValue');

        downloadSubmit.submit();
        //$("#downloadContent").attr("src","/replenishController/exportLogistics.do?"+params);
    }

    loadBalanceData();
</script>
<table id="dg" class="easyui-datagrid" title="对账信息导出" width="100%" height="300px"
       rownumbers="true" pagination="true"
       data-options="toolbar:'#tb',border:false,fit:true,fitColumns:true,singleSelect:true">
</table>
<div id="tb" style="padding:5px;height:auto">
    <div style="margin-bottom:5px">
        <!--<a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true"></a>-->
        <a id="exportBtn" href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="downloadBalance()">导出对账信息</a>
        <!--<a href="#" class="easyui-linkbutton" iconCls="icon-save" plain="true"></a>-->
        <!--<a href="#" class="easyui-linkbutton" iconCls="icon-cut" plain="true"></a>-->
        <!--<a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true"></a>-->
    </div>
    <div>
        客户名称：<input id="customerId" class="easyui-validatebox" style="width:150px" value="" />
        快递单号：<input id="balanceCode" class="easyui-validatebox" style="width:120px" value="" />
        收件日期：<input id="addresseeDate1" class="easyui-datebox" style="width:100px" data-options="formatter:myformatter,parser:myparser">
                到<input id="addresseeDate2" class="easyui-datebox" style="width:100px" data-options="formatter:myformatter,parser:myparser">
        结算状态：<select id="payoffState" class="easyui-combobox">
                    <option value="" selected>请选择</option>
                    <option value="1">已结</option>
                    <option value="2">未结</option>
                 </select>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search" onclick="loadBalanceData()">查询</a>
        <span class="money_sum">
            已结金额：<span id="money1">0</span><span style="width: 130px;height: 20px">&nbsp;</span>
            应收金额：<span id="money2">0</span>
        </span>
    </div>
</div>
<form action="/replenishController/exportLogistics.do" name="downloadSubmit" method="post" target="downloadContent">
    <input type="hidden" name="customerId" value="you"/>
</form>
<iframe id="downloadContent" name="downloadContent" src="" width="0" height="0" frameborder="0"></iframe>